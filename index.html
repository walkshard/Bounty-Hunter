<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bounty Hunter: Desert Wastes</title>
    <style>
        /* Classic Gameboy Palette */
        :root {
            --gb-darkest: #0f380f;
            --gb-dark: #306230;
            --gb-light: #8bac0f;
            --gb-lightest: #9bbc0f;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #111;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            touch-action: none; 
            font-family: monospace;
        }

        #game-container {
            width: 100%;
            max-width: 600px;
            background-color: var(--gb-lightest);
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            border-bottom: 4px solid var(--gb-darkest);
            position: relative;
        }

        canvas {
            image-rendering: pixelated;
            width: 100%;
            height: 100%;
            max-height: 60vh;
            object-fit: contain;
        }

        #controls {
            width: 100%;
            max-width: 600px;
            height: 40vh;
            background-color: var(--gb-light);
            display: flex;
            flex-direction: column;
            padding: 10px;
            box-sizing: border-box;
        }

        .control-row {
            display: flex;
            justify-content: space-between;
            flex: 1;
            margin-bottom: 10px;
        }

        .d-pad, .action-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .btn {
            background-color: var(--gb-darkest);
            color: var(--gb-lightest);
            border: 4px solid var(--gb-dark);
            border-radius: 8px;
            font-size: 24px;
            font-weight: bold;
            width: 70px;
            height: 70px;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
        }
        
        .btn:active { background-color: var(--gb-dark); }

        .action-buttons .btn {
            border-radius: 50%;
            width: 80px;
            height: 80px;
        }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas" width="320" height="288"></canvas>
</div>

<div id="controls">
    <div class="control-row">
        <div class="d-pad">
            <div class="btn" id="btn-left">◀</div>
            <div class="btn" id="btn-right">▶</div>
        </div>
        <div class="action-buttons">
            <div class="btn" id="btn-shoot">B</div>
            <div class="btn" id="btn-jump">A</div>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const COLOR = {
        bg: '#9bbc0f',
        light: '#8bac0f',
        dark: '#306230',
        solid: '#0f380f'
    };

    let cameraX = 0;
    let gameState = "PLAYING"; 
    const keys = { left: false, right: false, jump: false, shoot: false };

    // --- PLAYER STATS ---
    const player = {
        x: 50, y: 100, width: 16, height: 24,
        vx: 0, vy: 0, 
        speed: 2.5,       // Slightly faster for better gap clearing
        jumpPower: -6.5,  // Slightly higher jump
        grounded: false, facingRight: true,
        hp: 5, maxHp: 5, invulnTimer: 0
    };

    let lasers = [];
    let enemyLasers = [];
    let enemies = [];
    let boss = null;

    // --- LEVEL MAP (Desert) ---
    // Ground is exactly at Row 7. Gaps are now small enough to clear!
    const levelMap = [
        "                                                                                          ",
        "                                                                                          ",
        "                                                                                          ",
        "                                           111                                            ",
        "                        111                                                               ",
        "                                                     111            1111                  ",
        "               111                                                                        ",
        "11111111111111  1111111111   111111111111111111  11111111111111111111111111111111111111111",
        "11111111111111  1111111111   111111111111111111  11111111111111111111111111111111111111111"
    ];
    
    const tileSize = 32;
    const groundY = 7 * tileSize; // 224
    const levelWidth = levelMap[0].length * tileSize;
    const bossTriggerX = levelWidth - 400;

    let platforms = [];
    for (let row = 0; row < levelMap.length; row++) {
        for (let col = 0; col < levelMap[row].length; col++) {
            if (levelMap[row][col] === '1') {
                platforms.push({ x: col * tileSize, y: row * tileSize, width: tileSize, height: tileSize });
            }
        }
    }

    // Grounded Scorpions (y = 224 ground - 12 height = 212)
    enemies.push({ x: 300, y: 212, width: 16, height: 12, vx: -1, startX: 300, patrol: 40, hp: 2 });
    enemies.push({ x: 550, y: 212, width: 16, height: 12, vx: -1, startX: 550, patrol: 40, hp: 2 });
    enemies.push({ x: 1200, y: 212, width: 16, height: 12, vx: -1, startX: 1200, patrol: 40, hp: 2 });

    // --- CONTROLS LOGIC ---
    function setupControls() {
        const bindBtn = (id, key) => {
            const btn = document.getElementById(id);
            btn.addEventListener('touchstart', (e) => { e.preventDefault(); keys[key] = true; });
            btn.addEventListener('touchend', (e) => { e.preventDefault(); keys[key] = false; });
            btn.addEventListener('mousedown', (e) => { e.preventDefault(); keys[key] = true; });
            btn.addEventListener('mouseup', (e) => { e.preventDefault(); keys[key] = false; });
        };
        bindBtn('btn-left', 'left');
        bindBtn('btn-right', 'right');
        bindBtn('btn-jump', 'jump');
        
        const shootBtn = document.getElementById('btn-shoot');
        const fire = (e) => {
            e.preventDefault();
            if (gameState === "PLAYING" || gameState === "BOSS") {
                lasers.push({
                    x: player.facingRight ? player.x + 18 : player.x - 8,
                    y: player.y + 14, 
                    width: 6, height: 3,
                    vx: player.facingRight ? 6 : -6
                });
            } else if (gameState === "GAMEOVER" || gameState === "WIN") {
                location.reload(); 
            }
        };
        shootBtn.addEventListener('touchstart', fire);
        shootBtn.addEventListener('mousedown', fire);
    }

    // --- PHYSICS & COLLISION ---
    function checkAABB(r1, r2) {
        return r1.x < r2.x + r2.width &&
               r1.x + r1.width > r2.x &&
               r1.y < r2.y + r2.height &&
               r1.y + r1.height > r2.y;
    }

    function updatePlayer() {
        if (player.invulnTimer > 0) player.invulnTimer--;

        if (keys.left) { player.vx = -player.speed; player.facingRight = false; }
        else if (keys.right) { player.vx = player.speed; player.facingRight = true; }
        else { player.vx = 0; }

        player.x += player.vx;

        for (let p of platforms) {
            if (checkAABB(player, p)) {
                if (player.vx > 0) player.x = p.x - player.width;
                else if (player.vx < 0) player.x = p.x + p.width;
            }
        }

        if (player.x < cameraX) player.x = cameraX;

        player.vy += 0.3; 
        if (keys.jump && player.grounded) {
            player.vy = player.jumpPower;
            player.grounded = false;
        }
        
        player.y += player.vy;
        player.grounded = false;

        for (let p of platforms) {
            if (checkAABB(player, p)) {
                if (player.vy > 0) { 
                    player.y = p.y - player.height;
                    player.vy = 0;
                    player.grounded = true;
                } else if (player.vy < 0) { 
                    player.y = p.y + p.height;
                    player.vy = 0;
                }
            }
        }

        if (player.y > canvas.height) takeDamage(5);

        if (gameState === "PLAYING") {
            if (player.x > cameraX + canvas.width / 2) {
                cameraX = player.x - canvas.width / 2;
            }
            if (player.x > bossTriggerX) {
                gameState = "BOSS";
                spawnBoss();
            }
        }
    }

    function takeDamage(amt) {
        if (player.invulnTimer > 0) return;
        player.hp -= amt;
        player.invulnTimer = 30; 
        if (player.hp <= 0) gameState = "GAMEOVER";
    }

    function spawnBoss() {
        boss = {
            x: cameraX + 250, y: groundY - 48, width: 32, height: 48,
            hp: 25, maxHp: 25,
            state: "IDLE", timer: 0
        };
    }

    function updateBoss() {
        if (!boss) return;
        boss.timer++;
        
        if (boss.state === "IDLE") {
            if (boss.timer > 45) {
                boss.state = "ATTACK";
                boss.timer = 0;
            }
        } else if (boss.state === "ATTACK") {
            // Boss shoots spread lasers
            if (boss.timer === 10 || boss.timer === 30) {
                enemyLasers.push({ x: boss.x, y: boss.y + 16, width: 8, height: 4, vx: -4 });
            }
            if (boss.timer > 60) {
                boss.state = "JUMP";
                boss.timer = 0;
                boss.vy = -5;
            }
        } else if (boss.state === "JUMP") {
            boss.vy += 0.3;
            boss.y += boss.vy;
            if (boss.y > groundY - boss.height) {
                boss.y = groundY - boss.height;
                boss.vy = 0;
                boss.state = "IDLE";
                boss.timer = 0;
            }
        }

        if (checkAABB(player, boss)) takeDamage(1);
    }

    function update() {
        if (gameState === "PLAYING" || gameState === "BOSS") {
            updatePlayer();

            for (let i = lasers.length - 1; i >= 0; i--) {
                lasers[i].x += lasers[i].vx;
                let hit = false;
                
                for (let j = enemies.length - 1; j >= 0; j--) {
                    if (checkAABB(lasers[i], enemies[j])) {
                        enemies[j].hp--;
                        hit = true;
                        if (enemies[j].hp <= 0) enemies.splice(j, 1);
                        break;
                    }
                }

                if (boss && checkAABB(lasers[i], boss)) {
                    boss.hp--;
                    hit = true;
                    if (boss.hp <= 0) {
                        boss = null;
                        gameState = "WIN";
                    }
                }

                if (hit || lasers[i].x > cameraX + canvas.width || lasers[i].x < cameraX) {
                    lasers.splice(i, 1);
                }
            }

            for (let e of enemies) {
                e.x += e.vx;
                if (e.x > e.startX + e.patrol || e.x < e.startX - e.patrol) e.vx *= -1;
                if (checkAABB(player, e)) takeDamage(1);
            }

            for (let i = enemyLasers.length - 1; i >= 0; i--) {
                enemyLasers[i].x += enemyLasers[i].vx;
                if (checkAABB(player, enemyLasers[i])) {
                    takeDamage(1);
                    enemyLasers.splice(i, 1);
                }
            }

            if (gameState === "BOSS") updateBoss();
        }
    }

    // --- DRAWING FUNCTIONS ---
    function drawBackground() {
        ctx.save();
        
        // Parallax Mountains
        ctx.fillStyle = COLOR.dark;
        let mOffsetX = (cameraX * 0.2) % 320;
        for(let i = -1; i < 4; i++) {
            ctx.beginPath();
            ctx.moveTo(i * 100 - mOffsetX, groundY);
            ctx.lineTo(i * 100 + 50 - mOffsetX, 100);
            ctx.lineTo(i * 100 + 100 - mOffsetX, groundY);
            ctx.fill();
        }

        // Parallax Cactuses
        ctx.fillStyle = COLOR.solid;
        let cOffsetX = (cameraX * 0.5) % 320;
        for(let i = -1; i < 4; i++) {
            let cx = i * 150 - cOffsetX + 60;
            let cy = groundY - 30;
            ctx.fillRect(cx, cy, 8, 30); // Trunk
            ctx.fillRect(cx - 6, cy + 8, 6, 4); // Left arm
            ctx.fillRect(cx - 6, cy + 4, 4, 8);
            ctx.fillRect(cx + 8, cy + 14, 6, 4); // Right arm
            ctx.fillRect(cx + 10, cy + 10, 4, 8);
        }
        ctx.restore();
    }

    function draw() {
        ctx.fillStyle = COLOR.bg;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        drawBackground();

        ctx.save();
        ctx.translate(-cameraX, 0);

        // Draw Platforms (Sand blocks)
        for (let p of platforms) {
            if (p.x + p.width > cameraX && p.x < cameraX + canvas.width) {
                ctx.fillStyle = COLOR.dark;
                ctx.fillRect(p.x, p.y, p.width, p.height);
                ctx.fillStyle = COLOR.light;
                ctx.fillRect(p.x, p.y, p.width, 4); // Sandy top
            }
        }

        // Draw Scorpions
        for (let e of enemies) {
            let ex = e.x, ey = e.y;
            ctx.fillStyle = COLOR.solid;
            ctx.fillRect(ex + 4, ey + 4, 12, 8); // Body
            ctx.fillRect(ex, ey + 8, 4, 4); // Claws
            // Tail
            ctx.fillRect(ex + 12, ey - 4, 4, 8);
            ctx.fillRect(ex + 16, ey - 4, 4, 4); 
        }

        // Draw Boss (Mecha-Cactus)
        if (boss) {
            let bx = boss.x, by = boss.y;
            ctx.fillStyle = COLOR.dark;
            ctx.fillRect(bx, by, boss.width, boss.height);
            ctx.fillStyle = COLOR.solid;
            ctx.fillRect(bx - 8, by + 16, 8, 8); // Gun arm
            ctx.fillRect(bx + boss.width, by + 8, 8, 16); // Other arm
            ctx.fillStyle = COLOR.bg;
            ctx.fillRect(bx + 4, by + 8, 8, 8); // Robotic Eye
        }

        // Draw Player (Space Cowboy)
        if (player.invulnTimer % 4 < 2) {
            let px = player.x;
            let py = player.y;

            ctx.fillStyle = COLOR.solid;
            ctx.fillRect(px + 2, py, 12, 4); // Hat Crown
            ctx.fillRect(px - 4, py + 4, 24, 2); // Hat Brim
            
            ctx.fillStyle = COLOR.bg; 
            ctx.fillRect(px + 2, py + 6, 12, 6); // Face
            
            ctx.fillStyle = COLOR.solid; 
            if (player.facingRight) ctx.fillRect(px + 10, py + 8, 2, 2); // Eye Right
            else ctx.fillRect(px + 4, py + 8, 2, 2); // Eye Left
            
            ctx.fillStyle = COLOR.dark;
            ctx.fillRect(px, py + 12, 16, 8); // Poncho
            
            ctx.fillStyle = COLOR.solid;
            ctx.fillRect(px + 2, py + 20, 4, 4); // Legs
            ctx.fillRect(px + 10, py + 20, 4, 4);
            
            // Blaster
            if (player.facingRight) ctx.fillRect(px + 12, py + 14, 8, 3); 
            else ctx.fillRect(px - 4, py + 14, 8, 3); 
        }

        // Draw Lasers
        ctx.fillStyle = COLOR.solid;
        for (let l of lasers) ctx.fillRect(l.x, l.y, l.width, l.height);
        for (let l of enemyLasers) ctx.fillRect(l.x, l.y, l.width, l.height);

        ctx.restore();

        // UI
        ctx.fillStyle = COLOR.solid;
        ctx.font = "16px monospace";
        ctx.fillText("HP: " + "█".repeat(player.hp), 10, 20);

        if (gameState === "BOSS") {
            ctx.fillText("BOSS: " + "█".repeat(Math.ceil(boss.hp/2)), canvas.width / 2 - 80, 20);
        } else if (gameState === "GAMEOVER") {
            ctx.fillStyle = COLOR.solid;
            ctx.fillRect(canvas.width/2 - 60, canvas.height/2 - 30, 120, 60);
            ctx.fillStyle = COLOR.bg;
            ctx.fillText("GAME OVER", canvas.width/2 - 40, canvas.height/2 - 5);
            ctx.fillText("Tap B to retry", canvas.width/2 - 55, canvas.height/2 + 15);
        } else if (gameState === "WIN") {
            ctx.fillStyle = COLOR.solid;
            ctx.fillRect(canvas.width/2 - 80, canvas.height/2 - 30, 160, 60);
            ctx.fillStyle = COLOR.bg;
            ctx.fillText("SECTOR CLEARED", canvas.width/2 - 60, canvas.height/2 - 5);
            ctx.fillText("Tap B to replay", canvas.width/2 - 60, canvas.height/2 + 15);
        }
    }

    function loop() {
        update();
        draw();
        requestAnimationFrame(loop);
    }

    setupControls();
    loop();
</script>
</body>
</html>
